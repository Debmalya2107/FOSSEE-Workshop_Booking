{% extends "workshop_app/base.html" %}
{% load static %}

{% block title %}
    Workshop Status
{% endblock %}

{% block extra-dependencies %}
    <!-- Custom styles -->
    <style>
        .table-heading {
            color: #04a9cf;
            text-transform: uppercase;
            font-weight: bold;
            margin-bottom: 20px;
            animation: fadeInDown 0.8s ease;
        }

        .badge-success {
            background: linear-gradient(45deg, #28a745, #34ce57);
            animation: pulse 1.5s infinite;
        }

        .badge-warning {
            background: linear-gradient(45deg, #ffc107, #ffcd39);
        }

        .jumbotron {
            background: linear-gradient(135deg, #74ebd5 0%, #9face6 100%);
            color: #fff;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            animation: fadeIn 1s ease;
        }

        .material-icons.datepicker {
            cursor: pointer;
            color: #04a9cf;
            transition: transform 0.2s ease;
        }
        .material-icons.datepicker:hover {
            transform: scale(1.2);
            color: #007bff;
        }

        /* Animations */
        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }
        @keyframes fadeInDown {
            from {opacity: 0; transform: translateY(-20px);}
            to {opacity: 1; transform: translateY(0);}
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(40,167,69,0.6); }
            70% { box-shadow: 0 0 0 10px rgba(40,167,69,0); }
            100% { box-shadow: 0 0 0 0 rgba(40,167,69,0); }
        }

        /* Mobile adjustments */
        @media (max-width: 768px) {
            table {
                font-size: 0.9rem;
            }
            .jumbotron h1 {
                font-size: 1.8rem;
            }
        }
    </style>

    <!-- jQuery UI for datepicker -->
    <link rel="stylesheet" href="{% static 'workshop_app/css/jquery-ui.css' %}" type="text/css"/>
    <script src="{% static 'workshop_app/js/jquery-1.12.4.js' %}"></script>
    <script src="{% static 'workshop_app/js/jquery-ui.min.js' %}"></script>
{% endblock %}

{% block extra-custom-scripts %}
    {% load static %}
    <script src="{% static 'workshop_app/js/datepicker.js' %}"></script>
{% endblock %}

{% block content %}
    {% if not workshops %}
        <div class="container">
            <div class="jumbotron shadow-lg">
                <h1 class="display-4 animate__animated animate__fadeInDown">Welcome {{ user.first_name }}</h1>
                <p class="lead">Your workshop information will appear here.</p>
                <hr class="my-4">
                <p>Navigate to <b>Workshop List</b> and create a workshop from <b>Create Workshop</b> based on your expertise and availability.</p>
            </div>
        </div>
    {% else %}
        <h3 class="text-center table-heading">The Status of Your Workshops</h3>

        <!-- Accepted Workshops -->
        <div class="container mb-5">
            <h3 class="text-center table-heading">Workshops Accepted</h3>
            <div class="table-responsive shadow-sm rounded">
                <table class="table table-striped table-hover">
                    <thead class="thead-dark">
                    <tr>
                        <th>Coordinator Name</th>
                        <th>Institute</th>
                        <th>Workshop Name</th>
                        <th>Workshop Day</th>
                        <th>Status</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for workshop in workshops %}
                        {% if workshop.status %}
                            <tr class="animate__animated animate__fadeInUp">
                                <td>
                                    <a href="{% url 'workshop_app:view_profile' workshop.coordinator.id %}">
                                        {{ workshop.coordinator.get_full_name }}
                                    </a>
                                </td>
                                <td>{{ workshop.coordinator.profile.institute }}</td>
                                <td>{{ workshop.workshop_type|capfirst }}</td>
                                <td>
                                    {{ workshop.date|date }}
                                    {% if workshop.date > today %}
                                        <span class="material-icons datepicker"
                                              title="Click here to change date"
                                              onclick="changeDate('R,{{ workshop.date|safe }},{{ forloop.counter }}')">
                                            event
                                        </span>
                                        <div class="myDialogR{{ forloop.counter }}" style="display: none;" title="Select New Date">
                                            <form method="post" action="{% url 'workshop_app:change_workshop_date' workshop.id %}">
                                                {% csrf_token %}
                                                <input type="text" placeholder="New date" name="new_date" class="rDate{{ forloop.counter }} form-control my-2"/>
                                                <button class="btn btn-success btn-sm" type="submit">Save</button>
                                            </form>
                                        </div>
                                    {% endif %}
                                </td>
                                <td><span class="badge badge-success">{{ workshop.get_status }}</span></td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Proposed Workshops -->
        <div class="container">
            <h3 class="text-center table-heading">Workshops Proposed by Coordinators</h3>
            <div class="table-responsive shadow-sm rounded">
                <table class="table table-striped table-hover">
                    <thead class="thead-dark">
                    <tr>
                        <th>Coordinator Name</th>
                        <th>Institute</th>
                        <th>Workshop Name</th>
                        <th>Workshop Day</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for workshop in workshops %}
                        {% if not workshop.status and workshop.tnc_accepted %}
                            <tr class="animate__animated animate__fadeInUp">
                                <td>
                                    <a href="{% url 'workshop_app:view_profile' workshop.coordinator.id %}">
                                        {{ workshop.coordinator.get_full_name }}
                                    </a>
                                </td>
                                <td>{{ workshop.coordinator.profile.institute }}</td>
                                <td>{{ workshop.workshop_type }}</td>
                                <td>{{ workshop.date|date }}</td>
                                <td><span class="badge badge-warning">{{ workshop.get_status }}</span></td>
                                <td>
                                    <a href="{% url 'workshop_app:accept_workshop' workshop.id %}"
                                       class="btn btn-primary btn-sm shadow-sm"
                                       onclick="return confirm('Once accepted you cannot reject. You must personally contact the coordinator if the workshop needs to be cancelled. Proceed?')">
                                        Accept
                                    </a>
                                </td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    {% endif %}
{% endblock %}
